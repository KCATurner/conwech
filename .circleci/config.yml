version: 2.1

jobs:

  pages:
    docker:
    - image: python:latest
    steps:
    - add_ssh_keys:
        fingerprints:
          - "4a:30:b4:68:a8:21:16:35:b1:81:90:5f:39:56:32:1b"
    - checkout
    - run: python3 -V
    - run: pip3 install .
    - run: pip3 install sphinx
    - run: pip3 install sphinx-rtd-theme
    - run: pip3 install sphinxcontrib-autoprogram
    - run: sphinx-build -aETb html docs/source docs/build/html
    - run: sphinx-build -aETb html docs/source docs/stable
    - run: sphinx-build -aETb html docs/source docs/$(date +%Y.%m)
    - run: git config --global user.email "$GH_EMAIL"
    - run: git config --global user.name "$GH_NAME"
    - run: git add --all
    - run: git commit -m "Publishing updated documentation."
    - run: git status
    - run: git branch
    - run: git push origin stable:gh-pages

#  tests:
#    docker:
#    - image: python:latest
#    steps:
#    - checkout
#    - run: python -V

workflows:
  version: 2

#  testing:
#    triggers:
#      branches:
#        ignore:
#          - master
#          - stable
#          - gh-pages
#    jobs:
#      - tests

  deploy:
    jobs:
      - pages:
          filters:
            branches:
              only: stable
