version: 2.1

jobs:

  pages:
    docker:
    - image: python:latest
    steps:
    - checkout
    - run: python3 -V
    - run: pip3 install .
    - run: pip3 install sphinx
    - run: pip3 install sphinx-rtd-theme
    - run: pip3 install sphinxcontrib-autoprogram
    - run: version=$(date +%Y.%m)
    - run: sphinx-build -aETb html docs/source docs/$version
    - run: cp docs/$version docs/build/html
    - run: cp docs/$version docs/stable
    - run: git add --all
    - run: git commit -m "Publishing updated documentation."
    # git credentials?
    - run: git push origin gh-pages

#  tests:
#    docker:
#    - image: python:latest
#    steps:
#    - checkout
#    - run: python -V

workflows:
  version: 2

#  testing:
#    triggers:
#      branches:
#        ignore:
#          - master
#          - stable
#          - gh-pages
#    jobs:
#      - tests

  deploy:
    jobs:
      - pages:
          filters:
            branches:
              only: stable
